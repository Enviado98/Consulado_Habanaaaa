<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba API elTOQUE</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f9; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #333; }
        .price-box { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .usd { color: #0d9488; }
        .eur { color: #4f46e5; }
        
        /* Consola en pantalla para m√≥vil */
        #screen-console {
            background-color: #1e1e1e;
            color: #00ff00;
            font-family: monospace;
            text-align: left;
            padding: 10px;
            border-radius: 8px;
            height: 300px;
            overflow-y: scroll;
            font-size: 12px;
            border: 2px solid #333;
        }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .error { color: #ff4444; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üí∞ Tasas en Tiempo Real</h2>
        <div class="price-box">USD: <span id="usd-display" class="usd">---</span> CUP</div>
        <div class="price-box">EUR: <span id="eur-display" class="eur">---</span> CUP</div>
        <p style="font-size: 0.8rem; color: #666;">Actualizando cada 10 seg...</p>
    </div>

    <h3>üìü Registro de Diagn√≥stico (Log):</h3>
    <div id="screen-console">Esperando primera conexi√≥n...</div>

    <script>
        // --- CONFIGURACI√ìN ---
        const API_URL = "https://api.eltoque.com/v1/trm?cur=CUP";
        const TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTc2MzU4NDg4MCwianRpIjoiZmVhZTc2Y2YtODc4Yy00MjdmLTg5MGUtMmQ4MzRmOGE1MzAyIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjY5MWUyNWI3ZTkyYmU3N2VhM2RlMjE0ZSIsIm5iZiI6MTc2MzU4NDg4MCwiZXhwIjoxNzk1MTIwODgwfQ.qpxiSsg8ptDTYsXZPnnxC694lUoWmT1qyAvzLUfl1-8";
        
        // Funci√≥n para escribir en la pantalla negra
        function log(msg, type = 'info') {
            const consoleDiv = document.getElementById('screen-console');
            const time = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : '';
            consoleDiv.innerHTML = `<div class="log-line ${colorClass}">[${time}] ${msg}</div>` + consoleDiv.innerHTML;
        }

        async function fetchRates() {
            log("üîÑ Iniciando petici√≥n a elTOQUE...");

            try {
                // USAMOS PROXY PARA EVITAR BLOQUEO EN NAVEGADOR M√ìVIL
                const proxy = "https://corsproxy.io/?";
                const target = encodeURIComponent(API_URL);
                const finalUrl = proxy + target;

                const response = await fetch(finalUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Estado HTTP: ${response.status}`);
                }

                const data = await response.json();
                log("‚úÖ Datos recibidos (JSON Raw): " + JSON.stringify(data).substring(0, 100) + "...");

                // L√≥gica de extracci√≥n
                let usd = '---';
                let eur = '---';

                // Buscar en estructura: data.tasas o data.result o data directo
                if (data.tasas) {
                    usd = data.tasas.USD || 'No encontrado';
                    eur = data.tasas.EUR || 'No encontrado';
                } else if (data.USD) {
                    usd = data.USD;
                    eur = data.EUR;
                } else if (data.result && data.result.tasas) {
                    usd = data.result.tasas.USD;
                    eur = data.result.tasas.EUR;
                } else {
                    log("‚ö†Ô∏è Estructura JSON desconocida.", 'error');
                    log("JSON Completo: " + JSON.stringify(data));
                }

                // Actualizar pantalla
                document.getElementById('usd-display').textContent = parseFloat(usd).toFixed(0);
                document.getElementById('eur-display').textContent = parseFloat(eur).toFixed(0);

                log(`üí∞ √âXITO: D√≥lar ${usd} - Euro ${eur}`);

            } catch (error) {
                log("‚ùå ERROR: " + error.message, 'error');
            }
        }

        // Ejecutar al inicio
        fetchRates();

        // Repetir cada 10 segundos
        setInterval(fetchRates, 10000);

    </script>
</body>
</html>
