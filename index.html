<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba API elTOQUE v2</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f9; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #333; }
        .price-box { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .usd { color: #0d9488; }
        .eur { color: #4f46e5; }
        
        /* Consola en pantalla para m√≥vil */
        #screen-console {
            background-color: #1e1e1e;
            color: #00ff00;
            font-family: monospace;
            text-align: left;
            padding: 10px;
            border-radius: 8px;
            height: 300px;
            overflow-y: scroll;
            font-size: 12px;
            border: 2px solid #333;
        }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .error { color: #ff4444; }
        .success { color: #00ffff; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üí∞ Tasas elTOQUE (Prueba v2)</h2>
        <div class="price-box">USD: <span id="usd-display" class="usd">---</span> CUP</div>
        <div class="price-box">EUR: <span id="eur-display" class="eur">---</span> CUP</div>
        <p style="font-size: 0.8rem; color: #666;">Intentando nueva direcci√≥n...</p>
    </div>

    <h3>üìü Registro de Diagn√≥stico:</h3>
    <div id="screen-console">Iniciando v2...</div>

    <script>
        // --- üö® CAMBIO CLAVE: Nueva URL (tasas.eltoque.com/v1/trmi) ---
        const API_URL = "https://tasas.eltoque.com/v1/trmi"; 
        
        const TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTc2MzU4NDg4MCwianRpIjoiZmVhZTc2Y2YtODc4Yy00MjdmLTg5MGUtMmQ4MzRmOGE1MzAyIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjY5MWUyNWI3ZTkyYmU3N2VhM2RlMjE0ZSIsIm5iZiI6MTc2MzU4NDg4MCwiZXhwIjoxNzk1MTIwODgwfQ.qpxiSsg8ptDTYsXZPnnxC694lUoWmT1qyAvzLUfl1-8";
        
        function log(msg, type = 'info') {
            const consoleDiv = document.getElementById('screen-console');
            const time = new Date().toLocaleTimeString();
            let colorClass = '';
            if(type === 'error') colorClass = 'error';
            if(type === 'success') colorClass = 'success';
            
            consoleDiv.innerHTML = `<div class="log-line ${colorClass}">[${time}] ${msg}</div>` + consoleDiv.innerHTML;
        }

        async function fetchRates() {
            log("üîÑ Probando conexi√≥n a: tasas.eltoque.com...");

            try {
                // Usamos proxy para evitar bloqueo CORS en m√≥vil
                const proxy = "https://corsproxy.io/?";
                // Aseguramos que la URL viaje bien codificada
                const target = encodeURIComponent(API_URL);
                const finalUrl = proxy + target;

                const response = await fetch(finalUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    // Si falla, mostramos el error exacto (404, 401, 500...)
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                const data = await response.json();
                // Mostramos un pedacito del JSON para verificar estructura
                log("‚úÖ ¬°CONEXI√ìN EXITOSA!", 'success');
                log("üì¶ Datos: " + JSON.stringify(data).substring(0, 80) + "...");

                let usd = '---';
                let eur = '---';

                // L√≥gica inteligente para encontrar el precio donde sea que est√©
                if (data.USD) { usd = data.USD; eur = data.EUR; }
                else if (data.tasas && data.tasas.USD) { usd = data.tasas.USD; eur = data.tasas.EUR; }
                else if (data.result && data.result.tasas) { usd = data.result.tasas.USD; eur = data.result.tasas.EUR; }

                // Renderizado
                document.getElementById('usd-display').textContent = parseFloat(usd).toFixed(0);
                document.getElementById('eur-display').textContent = parseFloat(eur).toFixed(0);

                log(`üí∞ Actualizado: USD ${parseFloat(usd).toFixed(0)} | EUR ${parseFloat(eur).toFixed(0)}`, 'success');

            } catch (error) {
                log("‚ùå FALL√ì: " + error.message, 'error');
            }
        }

        // Ejecutar inmediatamente y luego cada 10 seg
        fetchRates();
        setInterval(fetchRates, 10000);

    </script>
</body>
</html>
